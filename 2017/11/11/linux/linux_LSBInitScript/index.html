<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="www.lizs.cc"><meta name="keywords" content="lizs, www.lizs.cc, lizs.cc"><title>Linux - LSBInitScript - lizs</title><!-- link(rel="stylesheet", type="text/css", href="//fonts.neworld.org/css?family=Source+Code+Pro")--><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><!-- #header--><div id="layout" class="layout-g"><div class="layout-r"><div id="sidebar"><div class="site-name"><h1 class="title"><a href="/." class="home">lizs</a></h1><!-- h1.hidden= current_title--><!-- a#logo(href=url_for('.'))= config.title--><p class="description">www.lizs.cc</p></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="www.lizs.cc"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="time">{date}</div><div class="title">{title}</div><!-- .tags {tags}--></a></div></template></div></div><!-- .search-pla--><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Comment-Conventions-for-Init-Scripts"><span class="toc-text">Comment Conventions for Init Scripts</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Init-Script-Functions"><span class="toc-text">Init Script Functions</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Init-Script-Actions"><span class="toc-text">Init Script Actions</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Installation-and-removal-of-Init-Scripts"><span class="toc-text">Installation and removal of Init Scripts</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 近期文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/05/01/python/abstract_base_classes/">Python - Abstract Base Classes</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/05/linux/centos6.6_deploy_php_mysql_nginx/">CentOS6.6 install PHP, MySQL and Nginx</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/05/linux/centos6.6_upgrade_python2.6/">CentOS6.6 upgrade Python2.6 to Python2.7</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/05/linux/cmd_netstat/">Linux command - netstat</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/03/python/http_server/">Python - HTTP Server</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/02/python/socket_server/">Python - Socket Server</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Cordova/">Cordova</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/">HTTP</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Others/">Others</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/">TCP/IP</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/algorithm/" style="font-size: 15px;">algorithm</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/cmd/" style="font-size: 15px;">cmd</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/tutorial/" style="font-size: 15px;">tutorial</a> <a href="/tags/cordova/" style="font-size: 15px;">cordova</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/others/" style="font-size: 15px;">others</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/tcp-ip/" style="font-size: 15px;">tcp/ip</a> <a href="/tags/django/" style="font-size: 15px;">django</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a></li></ul></div><div id="nav-menu"></div></div></div><div class="layout-l"><div class="content_container"><div class="post"><div class="header"><h1 class="post-title">Linux - LSBInitScript</h1><div class="post-meta"><p><span class="date">2017-11-11</span><span><a href="/categories/Linux/" class="category">Linux</a></span><span class="view_count"><i id="busuanzi_container_page_pv"><!-- i=  __('hits') + '数: '--><i id="busuanzi_value_page_pv"></i></i></span></p></div></div><div class="post-content"><p><a href="https://wiki.debian.org/LSBInitScripts" target="_blank" rel="noopener">wiki: LSBInitScripts</a><br><a href="http://refspecs.linuxfoundation.org/LSB_3.1.0/LSB-Core-generic/LSB-Core-generic/tocsysinit.html" target="_blank" rel="noopener">Linux Standard Base Core Specification 3.1</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">### BEGIN INIT INFO</span><br><span class="line"># Provides:			 autossh-proxy</span><br><span class="line"># Required-Start:	 $network</span><br><span class="line"># Required-Stop:	 $network</span><br><span class="line"># Default-Start:	 2 3 4 5</span><br><span class="line"># Default-Stop: 	 0 1 6</span><br><span class="line"># Short-Description: start and stop autossh-proxy</span><br><span class="line"># Description:		 autossh-proxy is a manager of socket5 proxy by ssh</span><br><span class="line">### END INIT INFO</span><br><span class="line"></span><br><span class="line"># Author: lizs &lt;lizsmail.com&gt;</span><br><span class="line"></span><br><span class="line">PATH=/sbin:/bin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin</span><br><span class="line"></span><br><span class="line">NAME=autossh</span><br><span class="line">AUTOSSH=/usr/bin/autossh</span><br><span class="line">AUTOSSH_PIDFILE=/var/run/$NAME.pid</span><br><span class="line"># AUTOSSH_LOGFILE=/var/log/$BASE.log</span><br><span class="line"># autossh can use environment variables to control features, e.g. AUTOSSH_PID.</span><br><span class="line"># more info see `man autossh`</span><br><span class="line">AUTOSSH_PID=&quot;/usr/bin/env AUTOSSH_PIDFILE=$&#123;AUTOSSH_PIDFILE&#125;&quot;</span><br><span class="line"># The autossh args</span><br><span class="line">AUTOSSH_ARGS=&quot;-M 0 -fqTN -D 1080 root@alizs.cc&quot;</span><br><span class="line"></span><br><span class="line"># Get lsb functions</span><br><span class="line">. /lib/lsb/init-functions</span><br><span class="line"></span><br><span class="line">do_start()</span><br><span class="line">&#123;</span><br><span class="line">	start-stop-daemon --start --quiet --oknodo \</span><br><span class="line">		--pidfile $AUTOSSH_PIDFILE \</span><br><span class="line">		--make-pidfile \</span><br><span class="line">		--exec $AUTOSSH_PID $AUTOSSH \</span><br><span class="line">		-- $AUTOSSH_ARGS</span><br><span class="line">	RETVAL=&quot;$?&quot;</span><br><span class="line">	return &quot;$&#123;RETVAL&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">do_stop()</span><br><span class="line">&#123;</span><br><span class="line">	# Return</span><br><span class="line">	# 0 if the daemon has been stopped</span><br><span class="line">	# 2 if the daemon could not be stopped</span><br><span class="line">	# other if a failure occured</span><br><span class="line">	start-stop-daemon --stop --quiet --oknodo \</span><br><span class="line">		--retry=TERM/5/KILL/5 \</span><br><span class="line">		--pidfile $AUTOSSH_PIDFILE \</span><br><span class="line">		--remove-pidfile</span><br><span class="line">	RETVAL=&quot;$?&quot;</span><br><span class="line">	return &quot;$&#123;RETVAL&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">do_restart()</span><br><span class="line">&#123;</span><br><span class="line">	exit 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">	status)</span><br><span class="line">		if init_is_upstart; then</span><br><span class="line">			exit 1</span><br><span class="line">		fi</span><br><span class="line">		status_of_proc -p &quot;$&#123;AUTOSSH_PIDFILE&#125;&quot; &quot;$&#123;AUTOSSH&#125;&quot; &quot;$&#123;NAME&#125;&quot;</span><br><span class="line">		;;</span><br><span class="line">	start)</span><br><span class="line">		if init_is_upstart; then</span><br><span class="line">			exit 1</span><br><span class="line">		fi</span><br><span class="line">		log_begin_msg &quot;Starting $&#123;NAME&#125;...&quot;</span><br><span class="line">		do_start</span><br><span class="line">		log_end_msg &quot;$?&quot; # e.g. [ok], failed!, (warning)</span><br><span class="line">		;;</span><br><span class="line">	stop)</span><br><span class="line">		if init_is_upstart; then</span><br><span class="line">			exit 1</span><br><span class="line">		fi</span><br><span class="line">		log_begin_msg &quot;Stopping $&#123;NAME&#125;...&quot;</span><br><span class="line">		do_stop</span><br><span class="line">		log_end_msg &quot;$?&quot;</span><br><span class="line">		;;</span><br><span class="line">	restart)</span><br><span class="line">		if init_is_upstart; then</span><br><span class="line">			exit 1</span><br><span class="line">		fi</span><br><span class="line">		log_begin_msg &quot;Restarting $&#123;NAME&#125;&quot;</span><br><span class="line">		do_restart</span><br><span class="line">		log_end_msg &quot;$?&quot;</span><br><span class="line">		;;</span><br><span class="line">	force-reload)</span><br><span class="line">		exit 0</span><br><span class="line">		;;</span><br><span class="line">	*)</span><br><span class="line">		log_failure_msg &quot;Usage: service $&#123;NAME&#125; &#123;status|start|stop|restart&#125;&quot;</span><br><span class="line">		;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="Comment-Conventions-for-Init-Scripts"><a href="#Comment-Conventions-for-Init-Scripts" class="headerlink" title="Comment Conventions for Init Scripts"></a>Comment Conventions for Init Scripts</h1><blockquote>
<p>Reference: <a href="http://refspecs.linuxfoundation.org/LSB_3.1.0/LSB-Core-generic/LSB-Core-generic/initscrcomconv.html" target="_blank" rel="noopener">Comment Conventions for Init Scripts</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">### BEGIN INIT INFO</span><br><span class="line"># Provides:          scriptname</span><br><span class="line"># Required-Start:    $network</span><br><span class="line"># Required-Stop:     $network</span><br><span class="line"># Should-Start:      cgroup-lite</span><br><span class="line"># Should-Stop:       cgroup-lite</span><br><span class="line"># Default-Start:     2 3 4 5</span><br><span class="line"># Default-Stop:      0 1 6</span><br><span class="line"># Short-Description: short_description</span><br><span class="line"># Description:       multiline_description</span><br><span class="line">### END INIT INFO</span><br></pre></td></tr></table></figure>
<ul>
<li><p>以上注释必须在以下两行分隔符内</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">### BEGIN INIT INFO</span><br><span class="line">### END INIT INFO</span><br></pre></td></tr></table></figure>
</li>
<li><p>前后两行分隔符内的注释要以 <code>#</code> 开头，并且后面至少要跟着一个空格。(<code>Description</code> 除外，<code>Description</code>注释可以是多行描述。)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># &#123;keyword&#125;: arg1 [arg2 ...]</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Provides: boot_facility_1 [boot_facility_2 ...]</code><br>Boot facilities provided by this init script. 该脚本要启动的服务的名称。</li>
<li><code>Required-Start: boot_facility_1 [boot_facility_2 ...]</code><br>Facilities which must be available during startup of this service. The init-script system should insure init scripts which provide the Required-Start facilities are started before starting this script. 启动该脚本服务的依赖设备。</li>
<li><code>Required-Stop: boot_facility_1 [boot_facility_2 ...]</code><br>Facilities which must be available during the shutdown of this service. The init-script system should avoid stopping init scripts which provide the Required-Stop facilities until this script is stopped. 关闭该脚本服务的依赖设备。</li>
<li><code>Should-Start: boot_facility_1 [boot_facility_2 ...]</code><br>Facilities which, if present, should be available during startup of this service. This allows for weak dependencies which do not cause the service to fail if a facility is not available. 启动该脚本服务应该提供的依赖，如果没有，也不会造成启动服务失败。</li>
<li><code>Should-Stop: boot_facility_1 [boot_facility_2]</code><br>Facilities which should be available during shutdown of this service. 关闭该脚本服务应该提供的依赖。</li>
<li><code>Default-Start: run_level_1 [run_level_2 ...]</code></li>
<li><code>Default-Stop: run_level_1 [run_level_2 ...]</code><br>which run levels should by default run the init script with a start (stop) argument to start (stop) the services controlled by the init script. 该脚本服务的运行等级(0~6)。<br>Run Level:<ul>
<li><code>0</code>: halt</li>
<li><code>1</code>: single user mode.</li>
<li><code>2</code>: multiuser with no network services exported.</li>
<li><code>3</code>: normal/full multiuser.</li>
<li><code>4</code>: reserved for local user, default is normal/full multiuser</li>
<li><code>5</code>: multiuser with a display manager or equivalent</li>
<li><code>6</code>: reboot</li>
</ul>
</li>
<li><code>Short-Description: short_description</code><br>Provide a brief description of the actions of the init script. Limited to a single line of text. 脚本服务简述，只能够为一行。</li>
<li><code>Description: multiline_description</code><br>Provide a more complete description of the actions of the init script. May span mulitple lines. In a multiline description, each continuation line shall begin with a <code>#</code> followed by tab character or a <code>#</code> followed by at least two space characters. The multiline description is terminated by the first line that does not match this criteria. 脚本服务的详细描述，可以分为多行。多行描述的时候，第二行开始每一行必须要 <code>#</code> 开头接着一个 <code>tab</code> 或者至少两个空格。</li>
</ul>
</li>
<li><p>Facility Names<br>Boot facilities are used to indicate dependencies in initialization scripts, as defined in Comment Conventions for Init Scripts. Facility names are assigned to scripts by the Provides: keyword. Facility names that begin with a dollar sign (<code>$</code>) are reserved system facility names.</p>
<blockquote>
<p>Note: Facility names are only recognized in the context of the init script comment block and are not available in the body of the init script. In particular, the use of the leading <code>$</code> character does not imply system facility names are subject to shell variable expansion, since they appear inside comments.</p>
</blockquote>
<ul>
<li><code>$local_fs</code>: all local file systems are mounted.</li>
<li><code>$remote_fs</code>: all remote file systems are available. In some configurations, file systems such as /usr may be remote. Many applications that require <code>$local_fs</code> will probably also require <code>$remote_fs</code>.</li>
<li><code>$network</code>: basic networking is available. Example: a server program could listen on a socket.</li>
<li><code>$named</code>: IP name-to-address translation, using the interfaces described in this specification, are available to the level the system normally provides them. Example: if a DNS query daemon normally provides this facility, then that daemon has been started.</li>
<li><code>$portmap</code>: daemons providing SunRPC/ONCRPC portmapping service as defined in <a href="http://refspecs.linuxfoundation.org/LSB_3.1.0/LSB-Core-generic/LSB-Core-generic/informativerefs.html#STD.RFC1833" target="_blank" rel="noopener">RFC 1833: Binding Protocols for ONC RPC Version 2</a> (if present) are running.</li>
<li><code>$syslog</code>: system logger is  operational.</li>
<li><code>$time</code>: the system time has been set, for example by using a network-based time program such as <code>ntp</code> or <code>rdate</code>, or via the hardware Real Time Clock.</li>
</ul>
</li>
</ul>
<p><strong>The comment conventions described are only required for init scripts installed by conforming applications. Conforming runtime implementations are not required to use this scheme in their system provided init scripts.</strong></p>
<h1 id="Init-Script-Functions"><a href="#Init-Script-Functions" class="headerlink" title="Init Script Functions"></a>Init Script Functions</h1><blockquote>
<p>Reference: <a href="http://refspecs.linuxfoundation.org/LSB_3.1.0/LSB-Core-generic/LSB-Core-generic/iniscrptfunc.html" target="_blank" rel="noopener">Init Script Functions</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. /lib/lsb/init-functions</span><br></pre></td></tr></table></figure>
<p>Each conforming init script shall execute the commands in the file /lib/lsb/init-functions in the current environment (see shell special built-in command dot).</p>
<ul>
<li><code>init_is_upstart</code>: If the currently running init daemon is upstart, return zero; if the calling init script belongs to package which also provides a native upstart job, it should generally exit non-zero in this case.</li>
<li><p><code>status_of_proc</code>: Return LSB status.</p>
<ul>
<li><code>$1</code>: daemon，init script 启动的进程</li>
<li><code>$2</code>: 进程名称</li>
<li><code>-p</code>: optional, daemon 的 pid 文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">status_of_proc -p &quot;/var/run/nginx.pid&quot; &quot;/usr/bin/nginx&quot; &quot;nginx&quot;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>log_begin_msg</code>: 记录并打印信息，一般用在执行某个操作的开始位置，记录信息可以在 <code>/var/log/syslog</code> 查看，<code>int log_begin_msg (char *message)</code>，传入值是一个信息字符串.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log_begin_msg  &quot;Starting autossh...&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>log_end_msg</code>: <code>int log_end_msg (int exitstatus)</code>，传入值是一个整型的退出状态值，根据状态值返回：<code>[ok]</code>, <code>failed!</code>, <code>(warning)</code> 等等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start-stop-daemon --start ...</span><br><span class="line">log_end_msg &quot;$?&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>log_success_msg</code>, <code>log_failure_msg</code>, <code>log_warning_msg</code> …<br>更多函数说明可以查看 <code>/lib/lsb/init-functions</code>。</p>
</li>
</ul>
<h1 id="Init-Script-Actions"><a href="#Init-Script-Actions" class="headerlink" title="Init Script Actions"></a>Init Script Actions</h1><blockquote>
<p>Reference: <a href="http://refspecs.linuxfoundation.org/LSB_3.1.0/LSB-Core-generic/LSB-Core-generic/iniscrptact.html" target="_blank" rel="noopener">Init Script Actions</a></p>
</blockquote>
<p>Init scripts provided by conforming applications shall accept a single argument which selects the action:</p>
<ul>
<li><code>start</code>: Start the service</li>
<li><code>stop</code>: Stop the service</li>
<li><code>restart</code>: Stop and restart the service if the service if already running, otherwise start the service.</li>
<li><code>try-restart</code>: Restart the service if the service is already running.</li>
<li><code>reload</code>: Cause the configuration of the service to be reloaded without actually stoping and restarting the service.</li>
<li><code>force-reload</code>: Cause the configuration to be reloaded if the service support this, otherwise restart the service if it is running.</li>
<li><code>status</code>: Print the current status of the service.</li>
</ul>
<p><strong>The <code>start</code>, <code>stop</code>, <code>restart</code>, <code>force-reload</code> and <code>status</code> actions shall be supported by all init scripts; the <code>reload</code> and <code>try-restart</code> actions are optional. Other init-scripts actions may be defined by the init script.</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">case &quot;$1&quot; in</span><br><span class="line">	status)</span><br><span class="line">		exit 0</span><br><span class="line">		;;</span><br><span class="line">	start)</span><br><span class="line">		exit 0</span><br><span class="line">		;;</span><br><span class="line">	stop)</span><br><span class="line">		exit 0</span><br><span class="line">		;;</span><br><span class="line">	restart)</span><br><span class="line">		exit 0</span><br><span class="line">		;;</span><br><span class="line">	force-reload)</span><br><span class="line">		exit 0</span><br><span class="line">		;;</span><br><span class="line">	*)</span><br><span class="line">		log_failure_msg &quot;Usage: service $&#123;NAME&#125; &#123;status|start|stop|restart&#125;&quot;</span><br><span class="line">		;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>
<h1 id="Installation-and-removal-of-Init-Scripts"><a href="#Installation-and-removal-of-Init-Scripts" class="headerlink" title="Installation and removal of Init Scripts"></a>Installation and removal of Init Scripts</h1><blockquote>
<p>Reference: <a href="http://alizs.cc/?p=52" target="_blank" rel="noopener">Linux - 管理系统服务</a></p>
</blockquote>
<ul>
<li><p><strong>CentOS</strong><br>Redhat 提供了 <code>chkconfig</code> 命令来管理系统的服务：</p>
<ul>
<li><code>chkconfig --list</code>：所有服务列表</li>
<li><code>chkconfig --list serviceName</code>：只显示 serverName 服务</li>
<li><code>chkconfig serviceName on</code>：开启 serverName 服务的自动启动</li>
<li><code>chkconfig serviceName off</code>：关闭 serverName 服务的自动启动</li>
<li><code>chkconfig --add serviceName</code>：添加服务</li>
<li><code>chkconfig --del serviceName</code>：删除服务</li>
</ul>
</li>
<li><p><strong>Ubuntu</strong><br>Ubuntu 是没有 <code>chkconfig</code> 命令的，而是提供了另外的命令来实现管理服务：</p>
<ul>
<li><code>sudo update-rc.d serviceName defaults</code>：添加服务，默认添加服务为自动启动，即 <code>/etc/rc0.d/</code> 到 <code>/etc/rc6.d</code> 各级别里面都添加了服务的启动软链接。</li>
<li><p><code>sudo update-rc.d serviceName remove</code>：删除服务，默认会删除所有级别的服务，即彻底删除服务。</p>
<blockquote>
<p>   如果，你想要配置各级别的启动情况，可以删除相应级别目录里面的服务软链接。</p>
</blockquote>
</li>
<li><p><code>systemctl daemon-reload</code>：修改过服务之后，用该命令来重新加载服务。</p>
</li>
</ul>
</li>
</ul>
</div><div class="tags"><a href="/tags/linux/">linux</a></div><div class="post-nav"><a href="/2017/11/12/linux/linux_add_autossh_system_service/" class="pre">Linux add autossh system service</a><a href="/2017/11/01/http/http_authentication/" class="next">HTTP - Authentication</a></div></div><!-- include _partial/footer--></div></div></div><a id="totop" href="#top"></a></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script></body></html>